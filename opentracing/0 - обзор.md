## Введение

Микросервисы представляют собой мощную архитектуру, но не без своих проблем, особенно в отношении отладки и наблюдения за распределенными транзакциями в сложных сетях - просто потому, что для этого нет вызовов в памяти или трассировки стека.

Именно здесь на помощь приходит распределенная трассировка. Распределенная трассировка обеспечивает решение для описания и анализа межпроцессных транзакций. Некоторые примеры использования распределенной трассировки, описанные в документе Dapper от Google, включают обнаружение аномалий, диагностику проблем устойчивого состояния, распределенное профилирование, атрибуцию ресурсов и моделирование рабочей нагрузки микросервисов.

## Распределенная трассировка: Ментальная модель

Большинство ментальных моделей для трассировки происходят от документа Dapper компании Google. В OpenTracing используются похожие существительные и глаголы.

![](Pasted%20image%2020230617150549.png)
1. Trace: Описание транзакции по мере ее прохождения через распределенную систему.
2. Span: Именованная, привязанная по времени операция, представляющая часть рабочего процесса. Операции принимают теги "ключ:значение", а также подробные структурированные журналы с временной меткой, привязанные к конкретному экземпляру операции.
3. Span context: Информация трассировки, сопровождающая распределенную транзакцию, в том числе при передаче от сервиса к сервису по сети или через шину сообщений. Контекст пролета содержит идентификатор трассировки, идентификатор пролета и любые другие данные, которые система трассировки должна передать последующему сервису.

## Четыре большие части
С точки зрения распределенной системы трассировки прикладного уровня, современная программная система выглядит как следующая схема:

![](Pasted%20image%2020230617150758.png)

Компоненты современной программной системы можно разделить на три категории:
- Приложение и бизнес-логика: Ваш код.
- Широко используемые библиотеки: Код других людей.
- Широко используемые сервисы: Чужая инфраструктура.

Эти три компонента имеют различные требования и определяют дизайн системы распределенной трассировки, которой поручен мониторинг приложения. В результате получается четыре важных компонента:

- A tracing instrumentation API: То, что оборачивает код приложения.
- Wire protocol: То, что отправляется вместе с данными приложения в запросах RPC.
- Data protocol: То, что отправляется асинхронно в вашу систему анализа.
- Analysis system: База данных и интерактивный пользовательский интерфейс для работы с данными трассировки.

## Как OpenTracing вписывается в это?
API OpenTracing предоставляет стандартную, нейтральную к производителю основу для инструментации. Это означает, что если разработчик хочет попробовать другую систему распределенной трассировки, то вместо того, чтобы повторять весь процесс инструментации для новой системы распределенной трассировки, он может просто изменить конфигурацию трассировщика.

